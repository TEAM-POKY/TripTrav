<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>리뷰 수정</title>
    <style>
        /* 팝업창 */
        .popup {
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* 배경 어둡게 조정 */
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* 팝업 내용 스타일 */
        .popup-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            height: 70%;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        textarea {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            resize: none;
            font-size: 14px;
        }

        #charCount {
            text-align: right;
            font-size: 12px;
            color: #666;
        }

        .image-upload {
            margin-top: 15px;
        }

        .image-preview {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }

        .image-preview img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        button {
            width: 100%;
            padding: 10px;
            margin-top: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        input[type="file"] {
            margin-top: 10px;
        }
    </style>
</head>
<body>
<div id="editPopup" class="popup">
    <th:block th:with="review=${review.review},image=${review.imagePaths}">
    <div class="popup-content">
        <h3>리뷰 수정</h3>
        <textarea id="reviewText" rows="5" placeholder="리뷰 내용을 수정하세요. (최대 200자)" maxlength="200">[[${review.reContent}]]</textarea>
        <div id="charCount">0 / 200</div>
        <div class="image-upload">
            <input type="file" id="imageInput" accept="image/*" multiple>
        </div>
        <div class="image-preview" id="imagePreview"></div>
        <button type="button" id="saveBtn" disabled>저장</button>
    </div>
    </th:block>
</div>

<script>
    const editPopup = document.getElementById("editPopup");
    const reviewText = document.getElementById("reviewText");
    const charCount = document.getElementById("charCount");
    const imageInput = document.getElementById("imageInput");
    const imagePreview = document.getElementById("imagePreview");
    const saveBtn = document.getElementById("saveBtn");

    // 팝업 외부를 클릭하면 닫기
    window.onclick = function(e) {
        if (e.target === editPopup) {
            editPopup.style.display = "none";
        }
    }

    // 리뷰 텍스트 글자 수 업데이트
    reviewText.addEventListener('input', function() {
        charCount.textContent = `${reviewText.value.length} / 200`;
        validateForm();
    });

    // 이미지 미리보기
    imageInput.addEventListener('change', function() {
        const files = imageInput.files;
        imagePreview.innerHTML = '';

        if (files.length > 3) {
            alert('최대 3장의 이미지만 업로드할 수 있습니다.');
            imageInput.value = ''; // 선택한 파일 초기화
            return;
        }

        Array.from(files).forEach(file => {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.createElement('img');
                img.src = e.target.result;
                imagePreview.appendChild(img);
            };
            reader.readAsDataURL(file);
        });

        validateForm();
    });

    // 저장 버튼 활성화 여부 체크
    function validateForm() {
        if (reviewText.value.length > 0 && imageInput.files.length <= 3) {
            saveBtn.disabled = false;
        } else {
            saveBtn.disabled = true;
        }
    }
</script>
</body>
</html>
